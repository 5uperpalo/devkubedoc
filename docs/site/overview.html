
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>overview - devkubedoc</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview-8-min-read" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="devkubedoc" class="md-header__button md-logo" aria-label="devkubedoc" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            devkubedoc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              overview
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue-grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/5uperpalo/devkubedoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devkubedoc
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link">
      home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="overview.html" class="md-tabs__link md-tabs__link--active">
        kubernetes
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="resource_management.html" class="md-tabs__link">
      resource_mgmt
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="openvpn.html" class="md-tabs__link">
      openvpn
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="code_profiling.html" class="md-tabs__link">
      code profiling
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="contacts.html" class="md-tabs__link">
      contacts
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="devkubedoc" class="md-nav__button md-logo" aria-label="devkubedoc" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    devkubedoc
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/5uperpalo/devkubedoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devkubedoc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="kubernetes" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="overview.html" class="md-nav__link md-nav__link--active">
        overview
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#namespaces" class="md-nav__link">
    Namespaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificates" class="md-nav__link">
    Certificates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-administration" class="md-nav__link">
    Cluster administration
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="kubernetes_services.html" class="md-nav__link">
        kubernetes_services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jupyterhub.html" class="md-nav__link">
        jupyterhub
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="resource_management.html" class="md-nav__link">
        resource_mgmt
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="openvpn.html" class="md-nav__link">
        openvpn
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="code_profiling.html" class="md-nav__link">
        code profiling
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="contacts.html" class="md-nav__link">
        contacts
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/5uperpalo/devkubedoc/edit/main/docs/sources/overview.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="overview-8-min-read">Overview <em>[8 min read]</em><a class="headerlink" href="#overview-8-min-read" title="Permanent link">&para;</a></h1>
<figure class="image" align="center">
  <img width="500" src="assets/images/kubernetes/01.png">
  <figcaption>Figure 1 Overview of SAI Kubernetes cluster</figcaption>
</figure>

<h2 id="namespaces">Namespaces<a class="headerlink" href="#namespaces" title="Permanent link">&para;</a></h2>
<p>Namespaces in Kubernetes provides a mechanism for separating groups of resources within a cluster. Usually, for many users spreaded across multiple teams. I found them also useful in a development, research-based environment. They provide a mechanism for logical separation and clearer, easier way of installing/uninstalling new services. For more information please see documentation on <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a>.</p>
<figure class="image" align="center">
  <img width="350" src="assets/images/kubernetes/02.png">
  <figcaption>Figure 2 Overview  of main cluster services</figcaption>
</figure>

<h3 id="description-of-namespaces-used-in-sai-kubernetes-implementation">Description of namespaces used in SAI Kubernetes implementation<a class="headerlink" href="#description-of-namespaces-used-in-sai-kubernetes-implementation" title="Permanent link">&para;</a></h3>
<ul>
<li>kube-system - default Kubernetes administration namespace</li>
<li>kube-public - default Kubernetes administration namespace</li>
<li>kube-node-lease - default Kubernetes administration namespace</li>
<li>sai - namespace reserved for JupyterHub, i.e. the initial(main) reason for Kubernetes implementation</li>
<li>metallb-system – Microk8s load balancer <a href="https://microk8s.io/docs/addon-metallb">addon</a> namespace, prerequisite for JupyterHub</li>
<li>gpu-operator-resources - Microk8s NVIDIA GPU support <a href="https://microk8s.io/docs/addon-gpu">addon</a> namespace to support spawning of GPU pods in JupyterHub</li>
<li>nfs-server-provisioner - Microk8s NFS Ganesha Server and Provisioner <a href="https://microk8s.io/docs/addon-nfs">addon</a> namespace; by default Microk8s uses <a href="https://microk8s.io/docs/addon-hostpath-storage">Hostpath Storage</a> for provisioning of <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Persistent Volumes</a>; this creates an issue if JupyterHub user spawns a pod on machine where he previously did not spawn a pod (e.g. he used CPU pod and now he wants to switch to GPU that is available on different physical machine); NFS solves this problem and was chosen among other network storage protocols due to its simplicity</li>
<li>kepler – <a href="https://sustainable-computing.io/">Kubernetes Efficient Power Level Exporter (Kepler)</a> namespace</li>
<li>monitoring – <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">kube-prometheus-stack</a> namespace providing services of Prometheus, Grafana and Alert manager, see the related <a href="https://github.com/prometheus-operator/kube-prometheus">documentation</a></li>
<li>ingress - Microk8s NGINX Ingress Controller <a href="https://microk8s.io/docs/addon-ingress">addon</a> namespace for forwarding of HTTP, HTTPS, TCP and UDP traffic</li>
</ul>
<h2 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h2>
<p>Kubernetes defines services as objects, or methods, for exposing application(or functionality), running on one or more pods, through internal cluster network. Kubernetes Service API exposes functionality of pods through combination of service name and port to overcome issues of pods communication withi cluster using their cluster internal IP addresses. In this documentation we extend this definition to call the service a bundle of services that provides single functionality for the user e.g. JupyterHub, which combines both JupyterHub service and JupyterHub-ssh service. For more information about Kuberntes service please see the <a href="https://kubernetes.io/docs/concepts/services-networking/service/">documentation</a>.</p>
<h3 id="jupyterhub-bundle">JupyterHub bundle<a class="headerlink" href="#jupyterhub-bundle" title="Permanent link">&para;</a></h3>
<ul>
<li>Both JupyterHub and JupyterHub-ssh are deployed in a main sai namespace as initially the purpose of the cluster was to provide ONLY this functionality.</li>
<li>JupyterHub (Z<a href="https://z2jh.jupyter.org/en/stable/jupyterhub/installation.html">ero to JupyterHub doc</a>): Zero to JupyterHub implementation provides easy implementation of JupyterHub in Kubernetes. The implementation is part of <a href="https://sustainable-open-science-and-software.github.io/">Sustainability in Open Source Projects</a> study, i.e. it is inline with SAI goals to contribute and participate in sustainable AI/ML projects. The implementation documentation provide easy to understand and optimize guidelines using helm charts.</li>
<li>JupyterHub-ssh (<a href="https://github.com/yuvipanda/jupyterhub-ssh">GitHub repo</a>): repository provides a way of access to spawned JupyterHub pods using SSH. The implementation can be extended to use SFTP between user machine and spawned JupyerHub pod. The SFTP extension requires additional configuration and troubleshooting. As the files can be easily uploaded/downloaded from spawned pods using Web GUI, I did not see a need to implement the extension.</li>
</ul>
<figure class="image" align="center">
  <img width="500" src="assets/images/kubernetes/03.png">
  <figcaption>Figure 3 Communication with and within JupyterHub</figcaption>
</figure>

<h3 id="kubernetes-energy-consumption-monitoring">Kubernetes energy consumption monitoring<a class="headerlink" href="#kubernetes-energy-consumption-monitoring" title="Permanent link">&para;</a></h3>
<p>Bundle of services implemented with focus on energy consumption monitoring of JupyterHub pods. As the implementation includes Prometheus and Grafana the usage of the services extends the initial idea.</p>
<figure class="image" align="center">
  <img width="750" src="assets/images/kubernetes/04.png">
  <figcaption>Figure 4 Kepler metrics export and visualization</figcaption>
</figure>

<ul>
<li><a href="https://github.com/sustainable-computing-io/kepler/blob/main/grafana-dashboards/Kepler-Exporter.json">Kepler Exporter</a> (<a href="https://sustainable-computing.io/installation/kepler-helm/">helm chart</a>): a part of Kubernetes-based Efficient Power Level Exporter – Model server bundle from <a href="https://github.com/sustainable-computing-io/kepler/blob/main/grafana-dashboards/Kepler-Exporter.json">Sustainable Computing</a> group; it’s a metric exporter utilizing Prometheus to expose power consumption metrics that are visualized in <a href="https://github.com/sustainable-computing-io/kepler/blob/main/grafana-dashboards/Kepler-Exporter.json">Kepler Grafana dashboard</a>; the metrics usage could be extended by power consumption estimation or Kubernetes energy efficiency improvement by <a href="https://github.com/sustainable-computing-io/peaks">PEAKS(Power Efficiency Aware Kubernetes Scheduler)</a> and <a href="https://github.com/sustainable-computing-io/clever">CLEVER(Container Level Energy-efficient VPA Recommender for Kubernetes)</a></li>
<li><a href="https://prometheus.io/">Prometheus</a> (<a href="https://github.com/prometheus-operator/kube-prometheus">helm chart</a>): a system and service monitoring system to collect metrics and raise alarms</li>
<li><a href="https://grafana.com/">Grafana</a> (<a href="https://github.com/prometheus-operator/kube-prometheus">helm chart</a>): query and visualization platform for monitoring, observation and alarm raising</li>
</ul>
<h3 id="administration">Administration<a class="headerlink" href="#administration" title="Permanent link">&para;</a></h3>
<p>Group of services assuring communication to cluster services, their monitoring and provisioning; including new service deployments.</p>
<ul>
<li>DNS (<a href="https://microk8s.io/docs/addon-dns">microk8s doc</a>): Service providing Domain Name System functionality for cluster pods</li>
<li>NFS (<a href="https://microk8s.io/docs/addon-nfs">microk8s doc</a>): Network File Server functionality for <a href="https://z2jh.jupyter.org/en/latest/jupyterhub/customizing/user-storage.html">Persistent Volume Claims</a> (PVCs) of JupyterHub user pods enabling user to spawn a pod on any cluster node and have same storage content</li>
<li>GPU support (<a href="https://microk8s.io/docs/addon-gpu">microk8s doc</a>): NVIDIA GPU support on cluster nodes and pods to enabling spawing JupyterHub pods utilizing not only node CPUs but also GPUs</li>
<li>Dashboard (<a href="https://microk8s.io/docs/addon-dashboard">microk8s doc</a>): activity and resource monitoring of the cluster</li>
<li>MetalLB (<a href="https://microk8s.io/docs/addon-metallb">microk8s doc</a>): network load balancer that is a prerequisitive for Zero to JupyterHub implementation</li>
<li><a href="https://github.com/prometheus/alertmanager">Alert Manager</a> (<a href="https://github.com/prometheus-operator/kube-prometheus">helm chart</a>): part of Prometheus eco system used to raise system alarms</li>
<li>Helm (<a href="https://microk8s.io/docs/addons">microk8s doc</a>): Kubernetes package manager for easy installation, configuration and optimization of deployments</li>
<li>Ingress (<a href="https://microk8s.io/docs/addon-ingress">microk8s doc</a>): NGINX ingress controller serving as a Kubernetes reverse proxy, i.e. to forward HTPP/HTTPS and TCP/UDP traffic to correct cluster services</li>
</ul>
<h2 id="certificates">Certificates<a class="headerlink" href="#certificates" title="Permanent link">&para;</a></h2>
<p>Administered by Centre de Serveis Informàtics (CSI) using <a href="https://www.sectigo.com/">Sectigo</a> Certification Authority as CTTC has a contract with them.
Certificate is stored in Kubernetes secrets as <code>jupyterhub-tls</code>:
<code>sai kubectl get secret -n sai</code></p>
<h2 id="cluster-administration">Cluster administration<a class="headerlink" href="#cluster-administration" title="Permanent link">&para;</a></h2>
<h3 id="known-issues-and-solutions">Known Issues and solutions<a class="headerlink" href="#known-issues-and-solutions" title="Permanent link">&para;</a></h3>
<ul>
<li>Adding new node to cluster (DNS &amp; GPU)</li>
<li>Incorrect DNS search space and DNS was configured on one of the nodes resulting on issues with ingress services relying on correct DNS entries for FQDNS, see <a href="https://microk8s.io/docs/addon-dns">commands</a> dns addon</li>
<li>GPU addon was not enabled in cluster resulting in issue with spawning JupyterHub pods that use GPUs, enabling GPU addon solved it</li>
<li>Forwarding http/https traffic</li>
<li>
<p>The forwarding of traffic to correct services on correct ports had to be configured according microk8s ingress documentation to enable reaching of the cluster administration services from outside of the cluster</p>
</li>
<li>
<p>Forwarding TCP traffic</p>
</li>
<li>Jupyterhub-ssh relies on usage of traefik for TCP port forwarding which is enabled in JupyterHub helm chart only if authohttps is enabled; autohttps uses letsencrypt to get certificate for https communication and for that the letsencrypt needs http port allowed on firewall; solution – manual certificate created by Sectigo(CTTC partner) and Ingress for TCP port forwarding of ssh traffic to jupyterhub-ssh service</li>
<li>https certificate verification in jupyterhub-ssh solution</li>
<li>manual certificate for jupyterhub is for unknown reason ignored by code from jupyterhub-ssh that is running on the jupyterhub-ssh pod; the certificate is recognized when the code is tested after connecting to a running jupyterhub-ssh pod but it’s ignored by the code running on the background; solution – after many tries with changing the default user, using root user in the pod etc. I adjusted the code in repository to ignore certificate validation, created and published the docker image to <a href="https://hub.docker.com/repository/docker/5uperpalo/jupyterhub-ssh-ssl-disabled/general">docker hub</a> and used it in the value.yaml configuration file for helm chart installation of jupyterhub-ssh</li>
<li>issues and solution related to remote connection to JupyterHub – see “SAI CTTC JupyterHub User guide”</li>
<li>Kubernetes dashboard only accessible with port forwarding and with generated token: I followed the official guide and created security risk by granding admin privileges to dashboard, see the <a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/README.md#admin-privileges">documentation</a></li>
<li>Jupyterhub ssl certificate: official documentation recommends autohttps using letsencrypt(creates a hole in security by enabling http from the internet) or manual cert; manual self-generated cert is an issue for other service and also prompts security alert for access the JupyterHub url; solution: use Sectigo certificate authority as it is a partner of CTTC</li>
<li>Jupyterhub unable to spawn pods on newly added cluster node: by default the implementation uses hostpath for user storage, see <a href="https://z2jh.jupyter.org/en/stable/jupyterhub/customizing/user-storage.html">documentation</a>; this mean that all user data is stored on node where he spawned his first pod and can’t be moved to other nodes; solution: use NFS</li>
<li>Define Jupyterhub pod configuration that can be used: solution by using Kubespawner in Jupyterhub configuration </li>
<li>JupyterHub pods being turned of after some time: disable cull option in the Jupyterhub configuration</li>
<li>Robust way of user authentication to JupyterHub (i.e. not adjusting the JupyterHub configuration every time someone needs an access): solution by using <a href="https://oauthenticator.readthedocs.io/en/latest/tutorials/provider-specific-setup/providers/github.html">GitHubOAuthenticator</a></li>
</ul>
<h3 id="troubleshooting-and-other-useful-commands">Troubleshooting and other useful commands<a class="headerlink" href="#troubleshooting-and-other-useful-commands" title="Permanent link">&para;</a></h3>
<h4 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h4>
<ul>
<li>Local port forwarding to a specific service: e.g. forward traffic to localhost on port 3000 to a jupyterhub-ssh service on port 22 in sai namespace located in Kubernetes cluster (ip address or FQDN can be of any cluster node)</li>
<li>on a local machine
<code>ssh -L 3000:localhost:3000 pmulinka@10.1.24.201</code></li>
<li>on node
<code>kubectl port-forward svc/jupyterhub-ssh 3000:22 -n sai</code></li>
<li>Pod status issues
<code>kubectl describe pod jupyterhub-ssh-7f58c4bc79-5lg5z</code></li>
<li>Connect to a pod
<code>kubectl exec jupyterhub-ssh-7f58c4bc79-5lg5z -n sai -it -- /bin/bash</code></li>
<li>Check pod logs</li>
<li>-f for continuous feed
<code>kubectl logs jupyterhub-ssh-7f58c4bc79-5lg5z -n sai -f</code></li>
</ul>
<h4 id="usefull-commands">Usefull commands<a class="headerlink" href="#usefull-commands" title="Permanent link">&para;</a></h4>
<ul>
<li>apply configuration to Kubernetes cluster (e.g. apply changes to configuration of the service)
<code>kubectl apply -f config.yaml</code></li>
<li>show all running pods, services, deployments
<code>kubectl get pods -A</code>
<code>kubectl get services -A</code>
<code>kubectl get deployments -A</code></li>
</ul>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              home
            </div>
          </div>
        </a>
      
      
        
        <a href="kubernetes_services.html" class="md-footer__link md-footer__link--next" aria-label="Next: kubernetes_services" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              kubernetes_services
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Pavol Mulinka
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.expand", "toc.integrate"], "search": "assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="stylesheets/extra.js"></script>
      
        <script src="javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>